<html>
<head>
<title>_ihatexml.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
.ln { color: #606366; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_ihatexml.py</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import</span><span class="s0">, </span><span class="s1">division</span><span class="s0">, </span><span class="s1">unicode_literals</span>
<a name="l2"><span class="ln">2    </span></a>
<a name="l3"><span class="ln">3    </span></a><span class="s0">import </span><span class="s1">re</span>
<a name="l4"><span class="ln">4    </span></a><span class="s0">import </span><span class="s1">warnings</span>
<a name="l5"><span class="ln">5    </span></a>
<a name="l6"><span class="ln">6    </span></a><span class="s0">from </span><span class="s1">.constants </span><span class="s0">import </span><span class="s1">DataLossWarning</span>
<a name="l7"><span class="ln">7    </span></a>
<a name="l8"><span class="ln">8    </span></a><span class="s1">baseChar = </span><span class="s2">&quot;&quot;&quot; 
<a name="l9"><span class="ln">9    </span></a>[#x0041-#x005A] | [#x0061-#x007A] | [#x00C0-#x00D6] | [#x00D8-#x00F6] | 
<a name="l10"><span class="ln">10   </span></a>[#x00F8-#x00FF] | [#x0100-#x0131] | [#x0134-#x013E] | [#x0141-#x0148] | 
<a name="l11"><span class="ln">11   </span></a>[#x014A-#x017E] | [#x0180-#x01C3] | [#x01CD-#x01F0] | [#x01F4-#x01F5] | 
<a name="l12"><span class="ln">12   </span></a>[#x01FA-#x0217] | [#x0250-#x02A8] | [#x02BB-#x02C1] | #x0386 | 
<a name="l13"><span class="ln">13   </span></a>[#x0388-#x038A] | #x038C | [#x038E-#x03A1] | [#x03A3-#x03CE] | 
<a name="l14"><span class="ln">14   </span></a>[#x03D0-#x03D6] | #x03DA | #x03DC | #x03DE | #x03E0 | [#x03E2-#x03F3] | 
<a name="l15"><span class="ln">15   </span></a>[#x0401-#x040C] | [#x040E-#x044F] | [#x0451-#x045C] | [#x045E-#x0481] | 
<a name="l16"><span class="ln">16   </span></a>[#x0490-#x04C4] | [#x04C7-#x04C8] | [#x04CB-#x04CC] | [#x04D0-#x04EB] | 
<a name="l17"><span class="ln">17   </span></a>[#x04EE-#x04F5] | [#x04F8-#x04F9] | [#x0531-#x0556] | #x0559 | 
<a name="l18"><span class="ln">18   </span></a>[#x0561-#x0586] | [#x05D0-#x05EA] | [#x05F0-#x05F2] | [#x0621-#x063A] | 
<a name="l19"><span class="ln">19   </span></a>[#x0641-#x064A] | [#x0671-#x06B7] | [#x06BA-#x06BE] | [#x06C0-#x06CE] | 
<a name="l20"><span class="ln">20   </span></a>[#x06D0-#x06D3] | #x06D5 | [#x06E5-#x06E6] | [#x0905-#x0939] | #x093D | 
<a name="l21"><span class="ln">21   </span></a>[#x0958-#x0961] | [#x0985-#x098C] | [#x098F-#x0990] | [#x0993-#x09A8] | 
<a name="l22"><span class="ln">22   </span></a>[#x09AA-#x09B0] | #x09B2 | [#x09B6-#x09B9] | [#x09DC-#x09DD] | 
<a name="l23"><span class="ln">23   </span></a>[#x09DF-#x09E1] | [#x09F0-#x09F1] | [#x0A05-#x0A0A] | [#x0A0F-#x0A10] | 
<a name="l24"><span class="ln">24   </span></a>[#x0A13-#x0A28] | [#x0A2A-#x0A30] | [#x0A32-#x0A33] | [#x0A35-#x0A36] | 
<a name="l25"><span class="ln">25   </span></a>[#x0A38-#x0A39] | [#x0A59-#x0A5C] | #x0A5E | [#x0A72-#x0A74] | 
<a name="l26"><span class="ln">26   </span></a>[#x0A85-#x0A8B] | #x0A8D | [#x0A8F-#x0A91] | [#x0A93-#x0AA8] | 
<a name="l27"><span class="ln">27   </span></a>[#x0AAA-#x0AB0] | [#x0AB2-#x0AB3] | [#x0AB5-#x0AB9] | #x0ABD | #x0AE0 | 
<a name="l28"><span class="ln">28   </span></a>[#x0B05-#x0B0C] | [#x0B0F-#x0B10] | [#x0B13-#x0B28] | [#x0B2A-#x0B30] | 
<a name="l29"><span class="ln">29   </span></a>[#x0B32-#x0B33] | [#x0B36-#x0B39] | #x0B3D | [#x0B5C-#x0B5D] | 
<a name="l30"><span class="ln">30   </span></a>[#x0B5F-#x0B61] | [#x0B85-#x0B8A] | [#x0B8E-#x0B90] | [#x0B92-#x0B95] | 
<a name="l31"><span class="ln">31   </span></a>[#x0B99-#x0B9A] | #x0B9C | [#x0B9E-#x0B9F] | [#x0BA3-#x0BA4] | 
<a name="l32"><span class="ln">32   </span></a>[#x0BA8-#x0BAA] | [#x0BAE-#x0BB5] | [#x0BB7-#x0BB9] | [#x0C05-#x0C0C] | 
<a name="l33"><span class="ln">33   </span></a>[#x0C0E-#x0C10] | [#x0C12-#x0C28] | [#x0C2A-#x0C33] | [#x0C35-#x0C39] | 
<a name="l34"><span class="ln">34   </span></a>[#x0C60-#x0C61] | [#x0C85-#x0C8C] | [#x0C8E-#x0C90] | [#x0C92-#x0CA8] | 
<a name="l35"><span class="ln">35   </span></a>[#x0CAA-#x0CB3] | [#x0CB5-#x0CB9] | #x0CDE | [#x0CE0-#x0CE1] | 
<a name="l36"><span class="ln">36   </span></a>[#x0D05-#x0D0C] | [#x0D0E-#x0D10] | [#x0D12-#x0D28] | [#x0D2A-#x0D39] | 
<a name="l37"><span class="ln">37   </span></a>[#x0D60-#x0D61] | [#x0E01-#x0E2E] | #x0E30 | [#x0E32-#x0E33] | 
<a name="l38"><span class="ln">38   </span></a>[#x0E40-#x0E45] | [#x0E81-#x0E82] | #x0E84 | [#x0E87-#x0E88] | #x0E8A | 
<a name="l39"><span class="ln">39   </span></a>#x0E8D | [#x0E94-#x0E97] | [#x0E99-#x0E9F] | [#x0EA1-#x0EA3] | #x0EA5 | 
<a name="l40"><span class="ln">40   </span></a>#x0EA7 | [#x0EAA-#x0EAB] | [#x0EAD-#x0EAE] | #x0EB0 | [#x0EB2-#x0EB3] | 
<a name="l41"><span class="ln">41   </span></a>#x0EBD | [#x0EC0-#x0EC4] | [#x0F40-#x0F47] | [#x0F49-#x0F69] | 
<a name="l42"><span class="ln">42   </span></a>[#x10A0-#x10C5] | [#x10D0-#x10F6] | #x1100 | [#x1102-#x1103] | 
<a name="l43"><span class="ln">43   </span></a>[#x1105-#x1107] | #x1109 | [#x110B-#x110C] | [#x110E-#x1112] | #x113C | 
<a name="l44"><span class="ln">44   </span></a>#x113E | #x1140 | #x114C | #x114E | #x1150 | [#x1154-#x1155] | #x1159 | 
<a name="l45"><span class="ln">45   </span></a>[#x115F-#x1161] | #x1163 | #x1165 | #x1167 | #x1169 | [#x116D-#x116E] | 
<a name="l46"><span class="ln">46   </span></a>[#x1172-#x1173] | #x1175 | #x119E | #x11A8 | #x11AB | [#x11AE-#x11AF] | 
<a name="l47"><span class="ln">47   </span></a>[#x11B7-#x11B8] | #x11BA | [#x11BC-#x11C2] | #x11EB | #x11F0 | #x11F9 | 
<a name="l48"><span class="ln">48   </span></a>[#x1E00-#x1E9B] | [#x1EA0-#x1EF9] | [#x1F00-#x1F15] | [#x1F18-#x1F1D] | 
<a name="l49"><span class="ln">49   </span></a>[#x1F20-#x1F45] | [#x1F48-#x1F4D] | [#x1F50-#x1F57] | #x1F59 | #x1F5B | 
<a name="l50"><span class="ln">50   </span></a>#x1F5D | [#x1F5F-#x1F7D] | [#x1F80-#x1FB4] | [#x1FB6-#x1FBC] | #x1FBE | 
<a name="l51"><span class="ln">51   </span></a>[#x1FC2-#x1FC4] | [#x1FC6-#x1FCC] | [#x1FD0-#x1FD3] | [#x1FD6-#x1FDB] | 
<a name="l52"><span class="ln">52   </span></a>[#x1FE0-#x1FEC] | [#x1FF2-#x1FF4] | [#x1FF6-#x1FFC] | #x2126 | 
<a name="l53"><span class="ln">53   </span></a>[#x212A-#x212B] | #x212E | [#x2180-#x2182] | [#x3041-#x3094] | 
<a name="l54"><span class="ln">54   </span></a>[#x30A1-#x30FA] | [#x3105-#x312C] | [#xAC00-#xD7A3]&quot;&quot;&quot;</span>
<a name="l55"><span class="ln">55   </span></a>
<a name="l56"><span class="ln">56   </span></a><span class="s1">ideographic = </span><span class="s2">&quot;&quot;&quot;[#x4E00-#x9FA5] | #x3007 | [#x3021-#x3029]&quot;&quot;&quot;</span>
<a name="l57"><span class="ln">57   </span></a>
<a name="l58"><span class="ln">58   </span></a><span class="s1">combiningCharacter = </span><span class="s2">&quot;&quot;&quot; 
<a name="l59"><span class="ln">59   </span></a>[#x0300-#x0345] | [#x0360-#x0361] | [#x0483-#x0486] | [#x0591-#x05A1] | 
<a name="l60"><span class="ln">60   </span></a>[#x05A3-#x05B9] | [#x05BB-#x05BD] | #x05BF | [#x05C1-#x05C2] | #x05C4 | 
<a name="l61"><span class="ln">61   </span></a>[#x064B-#x0652] | #x0670 | [#x06D6-#x06DC] | [#x06DD-#x06DF] | 
<a name="l62"><span class="ln">62   </span></a>[#x06E0-#x06E4] | [#x06E7-#x06E8] | [#x06EA-#x06ED] | [#x0901-#x0903] | 
<a name="l63"><span class="ln">63   </span></a>#x093C | [#x093E-#x094C] | #x094D | [#x0951-#x0954] | [#x0962-#x0963] | 
<a name="l64"><span class="ln">64   </span></a>[#x0981-#x0983] | #x09BC | #x09BE | #x09BF | [#x09C0-#x09C4] | 
<a name="l65"><span class="ln">65   </span></a>[#x09C7-#x09C8] | [#x09CB-#x09CD] | #x09D7 | [#x09E2-#x09E3] | #x0A02 | 
<a name="l66"><span class="ln">66   </span></a>#x0A3C | #x0A3E | #x0A3F | [#x0A40-#x0A42] | [#x0A47-#x0A48] | 
<a name="l67"><span class="ln">67   </span></a>[#x0A4B-#x0A4D] | [#x0A70-#x0A71] | [#x0A81-#x0A83] | #x0ABC | 
<a name="l68"><span class="ln">68   </span></a>[#x0ABE-#x0AC5] | [#x0AC7-#x0AC9] | [#x0ACB-#x0ACD] | [#x0B01-#x0B03] | 
<a name="l69"><span class="ln">69   </span></a>#x0B3C | [#x0B3E-#x0B43] | [#x0B47-#x0B48] | [#x0B4B-#x0B4D] | 
<a name="l70"><span class="ln">70   </span></a>[#x0B56-#x0B57] | [#x0B82-#x0B83] | [#x0BBE-#x0BC2] | [#x0BC6-#x0BC8] | 
<a name="l71"><span class="ln">71   </span></a>[#x0BCA-#x0BCD] | #x0BD7 | [#x0C01-#x0C03] | [#x0C3E-#x0C44] | 
<a name="l72"><span class="ln">72   </span></a>[#x0C46-#x0C48] | [#x0C4A-#x0C4D] | [#x0C55-#x0C56] | [#x0C82-#x0C83] | 
<a name="l73"><span class="ln">73   </span></a>[#x0CBE-#x0CC4] | [#x0CC6-#x0CC8] | [#x0CCA-#x0CCD] | [#x0CD5-#x0CD6] | 
<a name="l74"><span class="ln">74   </span></a>[#x0D02-#x0D03] | [#x0D3E-#x0D43] | [#x0D46-#x0D48] | [#x0D4A-#x0D4D] | 
<a name="l75"><span class="ln">75   </span></a>#x0D57 | #x0E31 | [#x0E34-#x0E3A] | [#x0E47-#x0E4E] | #x0EB1 | 
<a name="l76"><span class="ln">76   </span></a>[#x0EB4-#x0EB9] | [#x0EBB-#x0EBC] | [#x0EC8-#x0ECD] | [#x0F18-#x0F19] | 
<a name="l77"><span class="ln">77   </span></a>#x0F35 | #x0F37 | #x0F39 | #x0F3E | #x0F3F | [#x0F71-#x0F84] | 
<a name="l78"><span class="ln">78   </span></a>[#x0F86-#x0F8B] | [#x0F90-#x0F95] | #x0F97 | [#x0F99-#x0FAD] | 
<a name="l79"><span class="ln">79   </span></a>[#x0FB1-#x0FB7] | #x0FB9 | [#x20D0-#x20DC] | #x20E1 | [#x302A-#x302F] | 
<a name="l80"><span class="ln">80   </span></a>#x3099 | #x309A&quot;&quot;&quot;</span>
<a name="l81"><span class="ln">81   </span></a>
<a name="l82"><span class="ln">82   </span></a><span class="s1">digit = </span><span class="s2">&quot;&quot;&quot; 
<a name="l83"><span class="ln">83   </span></a>[#x0030-#x0039] | [#x0660-#x0669] | [#x06F0-#x06F9] | [#x0966-#x096F] | 
<a name="l84"><span class="ln">84   </span></a>[#x09E6-#x09EF] | [#x0A66-#x0A6F] | [#x0AE6-#x0AEF] | [#x0B66-#x0B6F] | 
<a name="l85"><span class="ln">85   </span></a>[#x0BE7-#x0BEF] | [#x0C66-#x0C6F] | [#x0CE6-#x0CEF] | [#x0D66-#x0D6F] | 
<a name="l86"><span class="ln">86   </span></a>[#x0E50-#x0E59] | [#x0ED0-#x0ED9] | [#x0F20-#x0F29]&quot;&quot;&quot;</span>
<a name="l87"><span class="ln">87   </span></a>
<a name="l88"><span class="ln">88   </span></a><span class="s1">extender = </span><span class="s2">&quot;&quot;&quot; 
<a name="l89"><span class="ln">89   </span></a>#x00B7 | #x02D0 | #x02D1 | #x0387 | #x0640 | #x0E46 | #x0EC6 | #x3005 | 
<a name="l90"><span class="ln">90   </span></a>#[#x3031-#x3035] | [#x309D-#x309E] | [#x30FC-#x30FE]&quot;&quot;&quot;</span>
<a name="l91"><span class="ln">91   </span></a>
<a name="l92"><span class="ln">92   </span></a><span class="s1">letter = </span><span class="s2">&quot; | &quot;</span><span class="s1">.join([baseChar</span><span class="s0">, </span><span class="s1">ideographic])</span>
<a name="l93"><span class="ln">93   </span></a>
<a name="l94"><span class="ln">94   </span></a><span class="s3"># Without the</span>
<a name="l95"><span class="ln">95   </span></a><span class="s1">name = </span><span class="s2">&quot; | &quot;</span><span class="s1">.join([letter</span><span class="s0">, </span><span class="s1">digit</span><span class="s0">, </span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s2">&quot;-&quot;</span><span class="s0">, </span><span class="s2">&quot;_&quot;</span><span class="s0">, </span><span class="s1">combiningCharacter</span><span class="s0">,</span>
<a name="l96"><span class="ln">96   </span></a>                   <span class="s1">extender])</span>
<a name="l97"><span class="ln">97   </span></a><span class="s1">nameFirst = </span><span class="s2">&quot; | &quot;</span><span class="s1">.join([letter</span><span class="s0">, </span><span class="s2">&quot;_&quot;</span><span class="s1">])</span>
<a name="l98"><span class="ln">98   </span></a>
<a name="l99"><span class="ln">99   </span></a><span class="s1">reChar = re.compile(</span><span class="s2">r&quot;#x([\d|A-F]{4,4})&quot;</span><span class="s1">)</span>
<a name="l100"><span class="ln">100  </span></a><span class="s1">reCharRange = re.compile(</span><span class="s2">r&quot;\[#x([\d|A-F]{4,4})-#x([\d|A-F]{4,4})\]&quot;</span><span class="s1">)</span>
<a name="l101"><span class="ln">101  </span></a>
<a name="l102"><span class="ln">102  </span></a>
<a name="l103"><span class="ln">103  </span></a><span class="s0">def </span><span class="s1">charStringToList(chars):</span>
<a name="l104"><span class="ln">104  </span></a>    <span class="s1">charRanges = [item.strip() </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">chars.split(</span><span class="s2">&quot; | &quot;</span><span class="s1">)]</span>
<a name="l105"><span class="ln">105  </span></a>    <span class="s1">rv = []</span>
<a name="l106"><span class="ln">106  </span></a>    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">charRanges:</span>
<a name="l107"><span class="ln">107  </span></a>        <span class="s1">foundMatch = </span><span class="s0">False</span>
<a name="l108"><span class="ln">108  </span></a>        <span class="s0">for </span><span class="s1">regexp </span><span class="s0">in </span><span class="s1">(reChar</span><span class="s0">, </span><span class="s1">reCharRange):</span>
<a name="l109"><span class="ln">109  </span></a>            <span class="s1">match = regexp.match(item)</span>
<a name="l110"><span class="ln">110  </span></a>            <span class="s0">if </span><span class="s1">match </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l111"><span class="ln">111  </span></a>                <span class="s1">rv.append([hexToInt(item) </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">match.groups()])</span>
<a name="l112"><span class="ln">112  </span></a>                <span class="s0">if </span><span class="s1">len(rv[-</span><span class="s4">1</span><span class="s1">]) == </span><span class="s4">1</span><span class="s1">:</span>
<a name="l113"><span class="ln">113  </span></a>                    <span class="s1">rv[-</span><span class="s4">1</span><span class="s1">] = rv[-</span><span class="s4">1</span><span class="s1">] * </span><span class="s4">2</span>
<a name="l114"><span class="ln">114  </span></a>                <span class="s1">foundMatch = </span><span class="s0">True</span>
<a name="l115"><span class="ln">115  </span></a>                <span class="s0">break</span>
<a name="l116"><span class="ln">116  </span></a>        <span class="s0">if not </span><span class="s1">foundMatch:</span>
<a name="l117"><span class="ln">117  </span></a>            <span class="s0">assert </span><span class="s1">len(item) == </span><span class="s4">1</span>
<a name="l118"><span class="ln">118  </span></a>
<a name="l119"><span class="ln">119  </span></a>            <span class="s1">rv.append([ord(item)] * </span><span class="s4">2</span><span class="s1">)</span>
<a name="l120"><span class="ln">120  </span></a>    <span class="s1">rv = normaliseCharList(rv)</span>
<a name="l121"><span class="ln">121  </span></a>    <span class="s0">return </span><span class="s1">rv</span>
<a name="l122"><span class="ln">122  </span></a>
<a name="l123"><span class="ln">123  </span></a>
<a name="l124"><span class="ln">124  </span></a><span class="s0">def </span><span class="s1">normaliseCharList(charList):</span>
<a name="l125"><span class="ln">125  </span></a>    <span class="s1">charList = sorted(charList)</span>
<a name="l126"><span class="ln">126  </span></a>    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">charList:</span>
<a name="l127"><span class="ln">127  </span></a>        <span class="s0">assert </span><span class="s1">item[</span><span class="s4">1</span><span class="s1">] &gt;= item[</span><span class="s4">0</span><span class="s1">]</span>
<a name="l128"><span class="ln">128  </span></a>    <span class="s1">rv = []</span>
<a name="l129"><span class="ln">129  </span></a>    <span class="s1">i = </span><span class="s4">0</span>
<a name="l130"><span class="ln">130  </span></a>    <span class="s0">while </span><span class="s1">i &lt; len(charList):</span>
<a name="l131"><span class="ln">131  </span></a>        <span class="s1">j = </span><span class="s4">1</span>
<a name="l132"><span class="ln">132  </span></a>        <span class="s1">rv.append(charList[i])</span>
<a name="l133"><span class="ln">133  </span></a>        <span class="s0">while </span><span class="s1">i + j &lt; len(charList) </span><span class="s0">and </span><span class="s1">charList[i + j][</span><span class="s4">0</span><span class="s1">] &lt;= rv[-</span><span class="s4">1</span><span class="s1">][</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">1</span><span class="s1">:</span>
<a name="l134"><span class="ln">134  </span></a>            <span class="s1">rv[-</span><span class="s4">1</span><span class="s1">][</span><span class="s4">1</span><span class="s1">] = charList[i + j][</span><span class="s4">1</span><span class="s1">]</span>
<a name="l135"><span class="ln">135  </span></a>            <span class="s1">j += </span><span class="s4">1</span>
<a name="l136"><span class="ln">136  </span></a>        <span class="s1">i += j</span>
<a name="l137"><span class="ln">137  </span></a>    <span class="s0">return </span><span class="s1">rv</span>
<a name="l138"><span class="ln">138  </span></a>
<a name="l139"><span class="ln">139  </span></a>
<a name="l140"><span class="ln">140  </span></a><span class="s3"># We don't really support characters above the BMP :(</span>
<a name="l141"><span class="ln">141  </span></a><span class="s1">max_unicode = int(</span><span class="s2">&quot;FFFF&quot;</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span>
<a name="l142"><span class="ln">142  </span></a>
<a name="l143"><span class="ln">143  </span></a>
<a name="l144"><span class="ln">144  </span></a><span class="s0">def </span><span class="s1">missingRanges(charList):</span>
<a name="l145"><span class="ln">145  </span></a>    <span class="s1">rv = []</span>
<a name="l146"><span class="ln">146  </span></a>    <span class="s0">if </span><span class="s1">charList[</span><span class="s4">0</span><span class="s1">] != </span><span class="s4">0</span><span class="s1">:</span>
<a name="l147"><span class="ln">147  </span></a>        <span class="s1">rv.append([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">charList[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">])</span>
<a name="l148"><span class="ln">148  </span></a>    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">item </span><span class="s0">in </span><span class="s1">enumerate(charList[:-</span><span class="s4">1</span><span class="s1">]):</span>
<a name="l149"><span class="ln">149  </span></a>        <span class="s1">rv.append([item[</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">charList[i + </span><span class="s4">1</span><span class="s1">][</span><span class="s4">0</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">])</span>
<a name="l150"><span class="ln">150  </span></a>    <span class="s0">if </span><span class="s1">charList[-</span><span class="s4">1</span><span class="s1">][</span><span class="s4">1</span><span class="s1">] != max_unicode:</span>
<a name="l151"><span class="ln">151  </span></a>        <span class="s1">rv.append([charList[-</span><span class="s4">1</span><span class="s1">][</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">max_unicode])</span>
<a name="l152"><span class="ln">152  </span></a>    <span class="s0">return </span><span class="s1">rv</span>
<a name="l153"><span class="ln">153  </span></a>
<a name="l154"><span class="ln">154  </span></a>
<a name="l155"><span class="ln">155  </span></a><span class="s0">def </span><span class="s1">listToRegexpStr(charList):</span>
<a name="l156"><span class="ln">156  </span></a>    <span class="s1">rv = []</span>
<a name="l157"><span class="ln">157  </span></a>    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">charList:</span>
<a name="l158"><span class="ln">158  </span></a>        <span class="s0">if </span><span class="s1">item[</span><span class="s4">0</span><span class="s1">] == item[</span><span class="s4">1</span><span class="s1">]:</span>
<a name="l159"><span class="ln">159  </span></a>            <span class="s1">rv.append(escapeRegexp(chr(item[</span><span class="s4">0</span><span class="s1">])))</span>
<a name="l160"><span class="ln">160  </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l161"><span class="ln">161  </span></a>            <span class="s1">rv.append(escapeRegexp(chr(item[</span><span class="s4">0</span><span class="s1">])) + </span><span class="s2">&quot;-&quot; </span><span class="s1">+</span>
<a name="l162"><span class="ln">162  </span></a>                      <span class="s1">escapeRegexp(chr(item[</span><span class="s4">1</span><span class="s1">])))</span>
<a name="l163"><span class="ln">163  </span></a>    <span class="s0">return </span><span class="s2">&quot;[%s]&quot; </span><span class="s1">% </span><span class="s2">&quot;&quot;</span><span class="s1">.join(rv)</span>
<a name="l164"><span class="ln">164  </span></a>
<a name="l165"><span class="ln">165  </span></a>
<a name="l166"><span class="ln">166  </span></a><span class="s0">def </span><span class="s1">hexToInt(hex_str):</span>
<a name="l167"><span class="ln">167  </span></a>    <span class="s0">return </span><span class="s1">int(hex_str</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span>
<a name="l168"><span class="ln">168  </span></a>
<a name="l169"><span class="ln">169  </span></a>
<a name="l170"><span class="ln">170  </span></a><span class="s0">def </span><span class="s1">escapeRegexp(string):</span>
<a name="l171"><span class="ln">171  </span></a>    <span class="s1">specialCharacters = (</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s2">&quot;^&quot;</span><span class="s0">, </span><span class="s2">&quot;$&quot;</span><span class="s0">, </span><span class="s2">&quot;*&quot;</span><span class="s0">, </span><span class="s2">&quot;+&quot;</span><span class="s0">, </span><span class="s2">&quot;?&quot;</span><span class="s0">, </span><span class="s2">&quot;{&quot;</span><span class="s0">, </span><span class="s2">&quot;}&quot;</span><span class="s0">,</span>
<a name="l172"><span class="ln">172  </span></a>                         <span class="s2">&quot;[&quot;</span><span class="s0">, </span><span class="s2">&quot;]&quot;</span><span class="s0">, </span><span class="s2">&quot;|&quot;</span><span class="s0">, </span><span class="s2">&quot;(&quot;</span><span class="s0">, </span><span class="s2">&quot;)&quot;</span><span class="s0">, </span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
<a name="l173"><span class="ln">173  </span></a>    <span class="s0">for </span><span class="s1">char </span><span class="s0">in </span><span class="s1">specialCharacters:</span>
<a name="l174"><span class="ln">174  </span></a>        <span class="s1">string = string.replace(char</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">&quot; </span><span class="s1">+ char)</span>
<a name="l175"><span class="ln">175  </span></a>
<a name="l176"><span class="ln">176  </span></a>    <span class="s0">return </span><span class="s1">string</span>
<a name="l177"><span class="ln">177  </span></a>
<a name="l178"><span class="ln">178  </span></a><span class="s3"># output from the above</span>
<a name="l179"><span class="ln">179  </span></a><span class="s1">nonXmlNameBMPRegexp = re.compile(</span><span class="s2">'[</span><span class="s0">\x00</span><span class="s2">-,/:-@</span><span class="s0">\\</span><span class="s2">[-</span><span class="s0">\\</span><span class="s2">^`</span><span class="s0">\\</span><span class="s2">{-</span><span class="s0">\xb6\xb8</span><span class="s2">-</span><span class="s0">\xbf\xd7\xf7\u0132</span><span class="s2">-</span><span class="s0">\u0133\u013f</span><span class="s2">-</span><span class="s0">\u0140\u0149\u017f\u01c4</span><span class="s2">-</span><span class="s0">\u01cc\u01f1</span><span class="s2">-</span><span class="s0">\u01f3\u01f6</span><span class="s2">-</span><span class="s0">\u01f9\u0218</span><span class="s2">-</span><span class="s0">\u024f\u02a9</span><span class="s2">-</span><span class="s0">\u02ba\u02c2</span><span class="s2">-</span><span class="s0">\u02cf\u02d2</span><span class="s2">-</span><span class="s0">\u02ff\u0346</span><span class="s2">-</span><span class="s0">\u035f\u0362</span><span class="s2">-</span><span class="s0">\u0385\u038b\u038d\u03a2\u03cf\u03d7</span><span class="s2">-</span><span class="s0">\u03d9\u03db\u03dd\u03df\u03e1\u03f4</span><span class="s2">-</span><span class="s0">\u0400\u040d\u0450\u045d\u0482\u0487</span><span class="s2">-</span><span class="s0">\u048f\u04c5</span><span class="s2">-</span><span class="s0">\u04c6\u04c9</span><span class="s2">-</span><span class="s0">\u04ca\u04cd</span><span class="s2">-</span><span class="s0">\u04cf\u04ec</span><span class="s2">-</span><span class="s0">\u04ed\u04f6</span><span class="s2">-</span><span class="s0">\u04f7\u04fa</span><span class="s2">-</span><span class="s0">\u0530\u0557</span><span class="s2">-</span><span class="s0">\u0558\u055a</span><span class="s2">-</span><span class="s0">\u0560\u0587</span><span class="s2">-</span><span class="s0">\u0590\u05a2\u05ba\u05be\u05c0\u05c3\u05c5</span><span class="s2">-</span><span class="s0">\u05cf\u05eb</span><span class="s2">-</span><span class="s0">\u05ef\u05f3</span><span class="s2">-</span><span class="s0">\u0620\u063b</span><span class="s2">-</span><span class="s0">\u063f\u0653</span><span class="s2">-</span><span class="s0">\u065f\u066a</span><span class="s2">-</span><span class="s0">\u066f\u06b8</span><span class="s2">-</span><span class="s0">\u06b9\u06bf\u06cf\u06d4\u06e9\u06ee</span><span class="s2">-</span><span class="s0">\u06ef\u06fa</span><span class="s2">-</span><span class="s0">\u0900\u0904\u093a</span><span class="s2">-</span><span class="s0">\u093b\u094e</span><span class="s2">-</span><span class="s0">\u0950\u0955</span><span class="s2">-</span><span class="s0">\u0957\u0964</span><span class="s2">-</span><span class="s0">\u0965\u0970</span><span class="s2">-</span><span class="s0">\u0980\u0984\u098d</span><span class="s2">-</span><span class="s0">\u098e\u0991</span><span class="s2">-</span><span class="s0">\u0992\u09a9\u09b1\u09b3</span><span class="s2">-</span><span class="s0">\u09b5\u09ba</span><span class="s2">-</span><span class="s0">\u09bb\u09bd\u09c5</span><span class="s2">-</span><span class="s0">\u09c6\u09c9</span><span class="s2">-</span><span class="s0">\u09ca\u09ce</span><span class="s2">-</span><span class="s0">\u09d6\u09d8</span><span class="s2">-</span><span class="s0">\u09db\u09de\u09e4</span><span class="s2">-</span><span class="s0">\u09e5\u09f2</span><span class="s2">-</span><span class="s0">\u0a01\u0a03</span><span class="s2">-</span><span class="s0">\u0a04\u0a0b</span><span class="s2">-</span><span class="s0">\u0a0e\u0a11</span><span class="s2">-</span><span class="s0">\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a</span><span class="s2">-</span><span class="s0">\u0a3b\u0a3d\u0a43</span><span class="s2">-</span><span class="s0">\u0a46\u0a49</span><span class="s2">-</span><span class="s0">\u0a4a\u0a4e</span><span class="s2">-</span><span class="s0">\u0a58\u0a5d\u0a5f</span><span class="s2">-</span><span class="s0">\u0a65\u0a75</span><span class="s2">-</span><span class="s0">\u0a80\u0a84\u0a8c\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba</span><span class="s2">-</span><span class="s0">\u0abb\u0ac6\u0aca\u0ace</span><span class="s2">-</span><span class="s0">\u0adf\u0ae1</span><span class="s2">-</span><span class="s0">\u0ae5\u0af0</span><span class="s2">-</span><span class="s0">\u0b00\u0b04\u0b0d</span><span class="s2">-</span><span class="s0">\u0b0e\u0b11</span><span class="s2">-</span><span class="s0">\u0b12\u0b29\u0b31\u0b34</span><span class="s2">-</span><span class="s0">\u0b35\u0b3a</span><span class="s2">-</span><span class="s0">\u0b3b\u0b44</span><span class="s2">-</span><span class="s0">\u0b46\u0b49</span><span class="s2">-</span><span class="s0">\u0b4a\u0b4e</span><span class="s2">-</span><span class="s0">\u0b55\u0b58</span><span class="s2">-</span><span class="s0">\u0b5b\u0b5e\u0b62</span><span class="s2">-</span><span class="s0">\u0b65\u0b70</span><span class="s2">-</span><span class="s0">\u0b81\u0b84\u0b8b</span><span class="s2">-</span><span class="s0">\u0b8d\u0b91\u0b96</span><span class="s2">-</span><span class="s0">\u0b98\u0b9b\u0b9d\u0ba0</span><span class="s2">-</span><span class="s0">\u0ba2\u0ba5</span><span class="s2">-</span><span class="s0">\u0ba7\u0bab</span><span class="s2">-</span><span class="s0">\u0bad\u0bb6\u0bba</span><span class="s2">-</span><span class="s0">\u0bbd\u0bc3</span><span class="s2">-</span><span class="s0">\u0bc5\u0bc9\u0bce</span><span class="s2">-</span><span class="s0">\u0bd6\u0bd8</span><span class="s2">-</span><span class="s0">\u0be6\u0bf0</span><span class="s2">-</span><span class="s0">\u0c00\u0c04\u0c0d\u0c11\u0c29\u0c34\u0c3a</span><span class="s2">-</span><span class="s0">\u0c3d\u0c45\u0c49\u0c4e</span><span class="s2">-</span><span class="s0">\u0c54\u0c57</span><span class="s2">-</span><span class="s0">\u0c5f\u0c62</span><span class="s2">-</span><span class="s0">\u0c65\u0c70</span><span class="s2">-</span><span class="s0">\u0c81\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba</span><span class="s2">-</span><span class="s0">\u0cbd\u0cc5\u0cc9\u0cce</span><span class="s2">-</span><span class="s0">\u0cd4\u0cd7</span><span class="s2">-</span><span class="s0">\u0cdd\u0cdf\u0ce2</span><span class="s2">-</span><span class="s0">\u0ce5\u0cf0</span><span class="s2">-</span><span class="s0">\u0d01\u0d04\u0d0d\u0d11\u0d29\u0d3a</span><span class="s2">-</span><span class="s0">\u0d3d\u0d44</span><span class="s2">-</span><span class="s0">\u0d45\u0d49\u0d4e</span><span class="s2">-</span><span class="s0">\u0d56\u0d58</span><span class="s2">-</span><span class="s0">\u0d5f\u0d62</span><span class="s2">-</span><span class="s0">\u0d65\u0d70</span><span class="s2">-</span><span class="s0">\u0e00\u0e2f\u0e3b</span><span class="s2">-</span><span class="s0">\u0e3f\u0e4f\u0e5a</span><span class="s2">-</span><span class="s0">\u0e80\u0e83\u0e85</span><span class="s2">-</span><span class="s0">\u0e86\u0e89\u0e8b</span><span class="s2">-</span><span class="s0">\u0e8c\u0e8e</span><span class="s2">-</span><span class="s0">\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8</span><span class="s2">-</span><span class="s0">\u0ea9\u0eac\u0eaf\u0eba\u0ebe</span><span class="s2">-</span><span class="s0">\u0ebf\u0ec5\u0ec7\u0ece</span><span class="s2">-</span><span class="s0">\u0ecf\u0eda</span><span class="s2">-</span><span class="s0">\u0f17\u0f1a</span><span class="s2">-</span><span class="s0">\u0f1f\u0f2a</span><span class="s2">-</span><span class="s0">\u0f34\u0f36\u0f38\u0f3a</span><span class="s2">-</span><span class="s0">\u0f3d\u0f48\u0f6a</span><span class="s2">-</span><span class="s0">\u0f70\u0f85\u0f8c</span><span class="s2">-</span><span class="s0">\u0f8f\u0f96\u0f98\u0fae</span><span class="s2">-</span><span class="s0">\u0fb0\u0fb8\u0fba</span><span class="s2">-</span><span class="s0">\u109f\u10c6</span><span class="s2">-</span><span class="s0">\u10cf\u10f7</span><span class="s2">-</span><span class="s0">\u10ff\u1101\u1104\u1108\u110a\u110d\u1113</span><span class="s2">-</span><span class="s0">\u113b\u113d\u113f\u1141</span><span class="s2">-</span><span class="s0">\u114b\u114d\u114f\u1151</span><span class="s2">-</span><span class="s0">\u1153\u1156</span><span class="s2">-</span><span class="s0">\u1158\u115a</span><span class="s2">-</span><span class="s0">\u115e\u1162\u1164\u1166\u1168\u116a</span><span class="s2">-</span><span class="s0">\u116c\u116f</span><span class="s2">-</span><span class="s0">\u1171\u1174\u1176</span><span class="s2">-</span><span class="s0">\u119d\u119f</span><span class="s2">-</span><span class="s0">\u11a7\u11a9</span><span class="s2">-</span><span class="s0">\u11aa\u11ac</span><span class="s2">-</span><span class="s0">\u11ad\u11b0</span><span class="s2">-</span><span class="s0">\u11b6\u11b9\u11bb\u11c3</span><span class="s2">-</span><span class="s0">\u11ea\u11ec</span><span class="s2">-</span><span class="s0">\u11ef\u11f1</span><span class="s2">-</span><span class="s0">\u11f8\u11fa</span><span class="s2">-</span><span class="s0">\u1dff\u1e9c</span><span class="s2">-</span><span class="s0">\u1e9f\u1efa</span><span class="s2">-</span><span class="s0">\u1eff\u1f16</span><span class="s2">-</span><span class="s0">\u1f17\u1f1e</span><span class="s2">-</span><span class="s0">\u1f1f\u1f46</span><span class="s2">-</span><span class="s0">\u1f47\u1f4e</span><span class="s2">-</span><span class="s0">\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e</span><span class="s2">-</span><span class="s0">\u1f7f\u1fb5\u1fbd\u1fbf</span><span class="s2">-</span><span class="s0">\u1fc1\u1fc5\u1fcd</span><span class="s2">-</span><span class="s0">\u1fcf\u1fd4</span><span class="s2">-</span><span class="s0">\u1fd5\u1fdc</span><span class="s2">-</span><span class="s0">\u1fdf\u1fed</span><span class="s2">-</span><span class="s0">\u1ff1\u1ff5\u1ffd</span><span class="s2">-</span><span class="s0">\u20cf\u20dd</span><span class="s2">-</span><span class="s0">\u20e0\u20e2</span><span class="s2">-</span><span class="s0">\u2125\u2127</span><span class="s2">-</span><span class="s0">\u2129\u212c</span><span class="s2">-</span><span class="s0">\u212d\u212f</span><span class="s2">-</span><span class="s0">\u217f\u2183</span><span class="s2">-</span><span class="s0">\u3004\u3006\u3008</span><span class="s2">-</span><span class="s0">\u3020\u3030\u3036</span><span class="s2">-</span><span class="s0">\u3040\u3095</span><span class="s2">-</span><span class="s0">\u3098\u309b</span><span class="s2">-</span><span class="s0">\u309c\u309f</span><span class="s2">-</span><span class="s0">\u30a0\u30fb\u30ff</span><span class="s2">-</span><span class="s0">\u3104\u312d</span><span class="s2">-</span><span class="s0">\u4dff\u9fa6</span><span class="s2">-</span><span class="s0">\uabff\ud7a4</span><span class="s2">-</span><span class="s0">\uffff</span><span class="s2">]'</span><span class="s1">)  </span><span class="s3"># noqa</span>
<a name="l180"><span class="ln">180  </span></a>
<a name="l181"><span class="ln">181  </span></a><span class="s1">nonXmlNameFirstBMPRegexp = re.compile(</span><span class="s2">'[</span><span class="s0">\x00</span><span class="s2">-@</span><span class="s0">\\</span><span class="s2">[-</span><span class="s0">\\</span><span class="s2">^`</span><span class="s0">\\</span><span class="s2">{-</span><span class="s0">\xbf\xd7\xf7\u0132</span><span class="s2">-</span><span class="s0">\u0133\u013f</span><span class="s2">-</span><span class="s0">\u0140\u0149\u017f\u01c4</span><span class="s2">-</span><span class="s0">\u01cc\u01f1</span><span class="s2">-</span><span class="s0">\u01f3\u01f6</span><span class="s2">-</span><span class="s0">\u01f9\u0218</span><span class="s2">-</span><span class="s0">\u024f\u02a9</span><span class="s2">-</span><span class="s0">\u02ba\u02c2</span><span class="s2">-</span><span class="s0">\u0385\u0387\u038b\u038d\u03a2\u03cf\u03d7</span><span class="s2">-</span><span class="s0">\u03d9\u03db\u03dd\u03df\u03e1\u03f4</span><span class="s2">-</span><span class="s0">\u0400\u040d\u0450\u045d\u0482</span><span class="s2">-</span><span class="s0">\u048f\u04c5</span><span class="s2">-</span><span class="s0">\u04c6\u04c9</span><span class="s2">-</span><span class="s0">\u04ca\u04cd</span><span class="s2">-</span><span class="s0">\u04cf\u04ec</span><span class="s2">-</span><span class="s0">\u04ed\u04f6</span><span class="s2">-</span><span class="s0">\u04f7\u04fa</span><span class="s2">-</span><span class="s0">\u0530\u0557</span><span class="s2">-</span><span class="s0">\u0558\u055a</span><span class="s2">-</span><span class="s0">\u0560\u0587</span><span class="s2">-</span><span class="s0">\u05cf\u05eb</span><span class="s2">-</span><span class="s0">\u05ef\u05f3</span><span class="s2">-</span><span class="s0">\u0620\u063b</span><span class="s2">-</span><span class="s0">\u0640\u064b</span><span class="s2">-</span><span class="s0">\u0670\u06b8</span><span class="s2">-</span><span class="s0">\u06b9\u06bf\u06cf\u06d4\u06d6</span><span class="s2">-</span><span class="s0">\u06e4\u06e7</span><span class="s2">-</span><span class="s0">\u0904\u093a</span><span class="s2">-</span><span class="s0">\u093c\u093e</span><span class="s2">-</span><span class="s0">\u0957\u0962</span><span class="s2">-</span><span class="s0">\u0984\u098d</span><span class="s2">-</span><span class="s0">\u098e\u0991</span><span class="s2">-</span><span class="s0">\u0992\u09a9\u09b1\u09b3</span><span class="s2">-</span><span class="s0">\u09b5\u09ba</span><span class="s2">-</span><span class="s0">\u09db\u09de\u09e2</span><span class="s2">-</span><span class="s0">\u09ef\u09f2</span><span class="s2">-</span><span class="s0">\u0a04\u0a0b</span><span class="s2">-</span><span class="s0">\u0a0e\u0a11</span><span class="s2">-</span><span class="s0">\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a</span><span class="s2">-</span><span class="s0">\u0a58\u0a5d\u0a5f</span><span class="s2">-</span><span class="s0">\u0a71\u0a75</span><span class="s2">-</span><span class="s0">\u0a84\u0a8c\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba</span><span class="s2">-</span><span class="s0">\u0abc\u0abe</span><span class="s2">-</span><span class="s0">\u0adf\u0ae1</span><span class="s2">-</span><span class="s0">\u0b04\u0b0d</span><span class="s2">-</span><span class="s0">\u0b0e\u0b11</span><span class="s2">-</span><span class="s0">\u0b12\u0b29\u0b31\u0b34</span><span class="s2">-</span><span class="s0">\u0b35\u0b3a</span><span class="s2">-</span><span class="s0">\u0b3c\u0b3e</span><span class="s2">-</span><span class="s0">\u0b5b\u0b5e\u0b62</span><span class="s2">-</span><span class="s0">\u0b84\u0b8b</span><span class="s2">-</span><span class="s0">\u0b8d\u0b91\u0b96</span><span class="s2">-</span><span class="s0">\u0b98\u0b9b\u0b9d\u0ba0</span><span class="s2">-</span><span class="s0">\u0ba2\u0ba5</span><span class="s2">-</span><span class="s0">\u0ba7\u0bab</span><span class="s2">-</span><span class="s0">\u0bad\u0bb6\u0bba</span><span class="s2">-</span><span class="s0">\u0c04\u0c0d\u0c11\u0c29\u0c34\u0c3a</span><span class="s2">-</span><span class="s0">\u0c5f\u0c62</span><span class="s2">-</span><span class="s0">\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba</span><span class="s2">-</span><span class="s0">\u0cdd\u0cdf\u0ce2</span><span class="s2">-</span><span class="s0">\u0d04\u0d0d\u0d11\u0d29\u0d3a</span><span class="s2">-</span><span class="s0">\u0d5f\u0d62</span><span class="s2">-</span><span class="s0">\u0e00\u0e2f\u0e31\u0e34</span><span class="s2">-</span><span class="s0">\u0e3f\u0e46</span><span class="s2">-</span><span class="s0">\u0e80\u0e83\u0e85</span><span class="s2">-</span><span class="s0">\u0e86\u0e89\u0e8b</span><span class="s2">-</span><span class="s0">\u0e8c\u0e8e</span><span class="s2">-</span><span class="s0">\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8</span><span class="s2">-</span><span class="s0">\u0ea9\u0eac\u0eaf\u0eb1\u0eb4</span><span class="s2">-</span><span class="s0">\u0ebc\u0ebe</span><span class="s2">-</span><span class="s0">\u0ebf\u0ec5</span><span class="s2">-</span><span class="s0">\u0f3f\u0f48\u0f6a</span><span class="s2">-</span><span class="s0">\u109f\u10c6</span><span class="s2">-</span><span class="s0">\u10cf\u10f7</span><span class="s2">-</span><span class="s0">\u10ff\u1101\u1104\u1108\u110a\u110d\u1113</span><span class="s2">-</span><span class="s0">\u113b\u113d\u113f\u1141</span><span class="s2">-</span><span class="s0">\u114b\u114d\u114f\u1151</span><span class="s2">-</span><span class="s0">\u1153\u1156</span><span class="s2">-</span><span class="s0">\u1158\u115a</span><span class="s2">-</span><span class="s0">\u115e\u1162\u1164\u1166\u1168\u116a</span><span class="s2">-</span><span class="s0">\u116c\u116f</span><span class="s2">-</span><span class="s0">\u1171\u1174\u1176</span><span class="s2">-</span><span class="s0">\u119d\u119f</span><span class="s2">-</span><span class="s0">\u11a7\u11a9</span><span class="s2">-</span><span class="s0">\u11aa\u11ac</span><span class="s2">-</span><span class="s0">\u11ad\u11b0</span><span class="s2">-</span><span class="s0">\u11b6\u11b9\u11bb\u11c3</span><span class="s2">-</span><span class="s0">\u11ea\u11ec</span><span class="s2">-</span><span class="s0">\u11ef\u11f1</span><span class="s2">-</span><span class="s0">\u11f8\u11fa</span><span class="s2">-</span><span class="s0">\u1dff\u1e9c</span><span class="s2">-</span><span class="s0">\u1e9f\u1efa</span><span class="s2">-</span><span class="s0">\u1eff\u1f16</span><span class="s2">-</span><span class="s0">\u1f17\u1f1e</span><span class="s2">-</span><span class="s0">\u1f1f\u1f46</span><span class="s2">-</span><span class="s0">\u1f47\u1f4e</span><span class="s2">-</span><span class="s0">\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e</span><span class="s2">-</span><span class="s0">\u1f7f\u1fb5\u1fbd\u1fbf</span><span class="s2">-</span><span class="s0">\u1fc1\u1fc5\u1fcd</span><span class="s2">-</span><span class="s0">\u1fcf\u1fd4</span><span class="s2">-</span><span class="s0">\u1fd5\u1fdc</span><span class="s2">-</span><span class="s0">\u1fdf\u1fed</span><span class="s2">-</span><span class="s0">\u1ff1\u1ff5\u1ffd</span><span class="s2">-</span><span class="s0">\u2125\u2127</span><span class="s2">-</span><span class="s0">\u2129\u212c</span><span class="s2">-</span><span class="s0">\u212d\u212f</span><span class="s2">-</span><span class="s0">\u217f\u2183</span><span class="s2">-</span><span class="s0">\u3006\u3008</span><span class="s2">-</span><span class="s0">\u3020\u302a</span><span class="s2">-</span><span class="s0">\u3040\u3095</span><span class="s2">-</span><span class="s0">\u30a0\u30fb</span><span class="s2">-</span><span class="s0">\u3104\u312d</span><span class="s2">-</span><span class="s0">\u4dff\u9fa6</span><span class="s2">-</span><span class="s0">\uabff\ud7a4</span><span class="s2">-</span><span class="s0">\uffff</span><span class="s2">]'</span><span class="s1">)  </span><span class="s3"># noqa</span>
<a name="l182"><span class="ln">182  </span></a>
<a name="l183"><span class="ln">183  </span></a><span class="s3"># Simpler things</span>
<a name="l184"><span class="ln">184  </span></a><span class="s1">nonPubidCharRegexp = re.compile(</span><span class="s2">&quot;[^</span><span class="s0">\x20\x0D\x0A</span><span class="s2">a-zA-Z0-9</span><span class="s0">\\</span><span class="s2">-'()+,./:=?;!*#@$_%]&quot;</span><span class="s1">)</span>
<a name="l185"><span class="ln">185  </span></a>
<a name="l186"><span class="ln">186  </span></a>
<a name="l187"><span class="ln">187  </span></a><span class="s0">class </span><span class="s1">InfosetFilter(object):</span>
<a name="l188"><span class="ln">188  </span></a>    <span class="s1">replacementRegexp = re.compile(</span><span class="s2">r&quot;U[\dA-F]{5,5}&quot;</span><span class="s1">)</span>
<a name="l189"><span class="ln">189  </span></a>
<a name="l190"><span class="ln">190  </span></a>    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
<a name="l191"><span class="ln">191  </span></a>                 <span class="s1">dropXmlnsLocalName=</span><span class="s0">False,</span>
<a name="l192"><span class="ln">192  </span></a>                 <span class="s1">dropXmlnsAttrNs=</span><span class="s0">False,</span>
<a name="l193"><span class="ln">193  </span></a>                 <span class="s1">preventDoubleDashComments=</span><span class="s0">False,</span>
<a name="l194"><span class="ln">194  </span></a>                 <span class="s1">preventDashAtCommentEnd=</span><span class="s0">False,</span>
<a name="l195"><span class="ln">195  </span></a>                 <span class="s1">replaceFormFeedCharacters=</span><span class="s0">True,</span>
<a name="l196"><span class="ln">196  </span></a>                 <span class="s1">preventSingleQuotePubid=</span><span class="s0">False</span><span class="s1">):</span>
<a name="l197"><span class="ln">197  </span></a>
<a name="l198"><span class="ln">198  </span></a>        <span class="s1">self.dropXmlnsLocalName = dropXmlnsLocalName</span>
<a name="l199"><span class="ln">199  </span></a>        <span class="s1">self.dropXmlnsAttrNs = dropXmlnsAttrNs</span>
<a name="l200"><span class="ln">200  </span></a>
<a name="l201"><span class="ln">201  </span></a>        <span class="s1">self.preventDoubleDashComments = preventDoubleDashComments</span>
<a name="l202"><span class="ln">202  </span></a>        <span class="s1">self.preventDashAtCommentEnd = preventDashAtCommentEnd</span>
<a name="l203"><span class="ln">203  </span></a>
<a name="l204"><span class="ln">204  </span></a>        <span class="s1">self.replaceFormFeedCharacters = replaceFormFeedCharacters</span>
<a name="l205"><span class="ln">205  </span></a>
<a name="l206"><span class="ln">206  </span></a>        <span class="s1">self.preventSingleQuotePubid = preventSingleQuotePubid</span>
<a name="l207"><span class="ln">207  </span></a>
<a name="l208"><span class="ln">208  </span></a>        <span class="s1">self.replaceCache = {}</span>
<a name="l209"><span class="ln">209  </span></a>
<a name="l210"><span class="ln">210  </span></a>    <span class="s0">def </span><span class="s1">coerceAttribute(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">namespace=</span><span class="s0">None</span><span class="s1">):</span>
<a name="l211"><span class="ln">211  </span></a>        <span class="s0">if </span><span class="s1">self.dropXmlnsLocalName </span><span class="s0">and </span><span class="s1">name.startswith(</span><span class="s2">&quot;xmlns:&quot;</span><span class="s1">):</span>
<a name="l212"><span class="ln">212  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Attributes cannot begin with xmlns&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l213"><span class="ln">213  </span></a>            <span class="s0">return None</span>
<a name="l214"><span class="ln">214  </span></a>        <span class="s0">elif </span><span class="s1">(self.dropXmlnsAttrNs </span><span class="s0">and</span>
<a name="l215"><span class="ln">215  </span></a>              <span class="s1">namespace == </span><span class="s2">&quot;http://www.w3.org/2000/xmlns/&quot;</span><span class="s1">):</span>
<a name="l216"><span class="ln">216  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Attributes cannot be in the xml namespace&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l217"><span class="ln">217  </span></a>            <span class="s0">return None</span>
<a name="l218"><span class="ln">218  </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l219"><span class="ln">219  </span></a>            <span class="s0">return </span><span class="s1">self.toXmlName(name)</span>
<a name="l220"><span class="ln">220  </span></a>
<a name="l221"><span class="ln">221  </span></a>    <span class="s0">def </span><span class="s1">coerceElement(self</span><span class="s0">, </span><span class="s1">name):</span>
<a name="l222"><span class="ln">222  </span></a>        <span class="s0">return </span><span class="s1">self.toXmlName(name)</span>
<a name="l223"><span class="ln">223  </span></a>
<a name="l224"><span class="ln">224  </span></a>    <span class="s0">def </span><span class="s1">coerceComment(self</span><span class="s0">, </span><span class="s1">data):</span>
<a name="l225"><span class="ln">225  </span></a>        <span class="s0">if </span><span class="s1">self.preventDoubleDashComments:</span>
<a name="l226"><span class="ln">226  </span></a>            <span class="s0">while </span><span class="s2">&quot;--&quot; </span><span class="s0">in </span><span class="s1">data:</span>
<a name="l227"><span class="ln">227  </span></a>                <span class="s1">warnings.warn(</span><span class="s2">&quot;Comments cannot contain adjacent dashes&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l228"><span class="ln">228  </span></a>                <span class="s1">data = data.replace(</span><span class="s2">&quot;--&quot;</span><span class="s0">, </span><span class="s2">&quot;- -&quot;</span><span class="s1">)</span>
<a name="l229"><span class="ln">229  </span></a>            <span class="s0">if </span><span class="s1">data.endswith(</span><span class="s2">&quot;-&quot;</span><span class="s1">):</span>
<a name="l230"><span class="ln">230  </span></a>                <span class="s1">warnings.warn(</span><span class="s2">&quot;Comments cannot end in a dash&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l231"><span class="ln">231  </span></a>                <span class="s1">data += </span><span class="s2">&quot; &quot;</span>
<a name="l232"><span class="ln">232  </span></a>        <span class="s0">return </span><span class="s1">data</span>
<a name="l233"><span class="ln">233  </span></a>
<a name="l234"><span class="ln">234  </span></a>    <span class="s0">def </span><span class="s1">coerceCharacters(self</span><span class="s0">, </span><span class="s1">data):</span>
<a name="l235"><span class="ln">235  </span></a>        <span class="s0">if </span><span class="s1">self.replaceFormFeedCharacters:</span>
<a name="l236"><span class="ln">236  </span></a>            <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(data.count(</span><span class="s2">&quot;</span><span class="s0">\x0C</span><span class="s2">&quot;</span><span class="s1">)):</span>
<a name="l237"><span class="ln">237  </span></a>                <span class="s1">warnings.warn(</span><span class="s2">&quot;Text cannot contain U+000C&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l238"><span class="ln">238  </span></a>            <span class="s1">data = data.replace(</span><span class="s2">&quot;</span><span class="s0">\x0C</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s2">&quot; &quot;</span><span class="s1">)</span>
<a name="l239"><span class="ln">239  </span></a>        <span class="s3"># Other non-xml characters</span>
<a name="l240"><span class="ln">240  </span></a>        <span class="s0">return </span><span class="s1">data</span>
<a name="l241"><span class="ln">241  </span></a>
<a name="l242"><span class="ln">242  </span></a>    <span class="s0">def </span><span class="s1">coercePubid(self</span><span class="s0">, </span><span class="s1">data):</span>
<a name="l243"><span class="ln">243  </span></a>        <span class="s1">dataOutput = data</span>
<a name="l244"><span class="ln">244  </span></a>        <span class="s0">for </span><span class="s1">char </span><span class="s0">in </span><span class="s1">nonPubidCharRegexp.findall(data):</span>
<a name="l245"><span class="ln">245  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Coercing non-XML pubid&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l246"><span class="ln">246  </span></a>            <span class="s1">replacement = self.getReplacementCharacter(char)</span>
<a name="l247"><span class="ln">247  </span></a>            <span class="s1">dataOutput = dataOutput.replace(char</span><span class="s0">, </span><span class="s1">replacement)</span>
<a name="l248"><span class="ln">248  </span></a>        <span class="s0">if </span><span class="s1">self.preventSingleQuotePubid </span><span class="s0">and </span><span class="s1">dataOutput.find(</span><span class="s2">&quot;'&quot;</span><span class="s1">) &gt;= </span><span class="s4">0</span><span class="s1">:</span>
<a name="l249"><span class="ln">249  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Pubid cannot contain single quote&quot;</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l250"><span class="ln">250  </span></a>            <span class="s1">dataOutput = dataOutput.replace(</span><span class="s2">&quot;'&quot;</span><span class="s0">, </span><span class="s1">self.getReplacementCharacter(</span><span class="s2">&quot;'&quot;</span><span class="s1">))</span>
<a name="l251"><span class="ln">251  </span></a>        <span class="s0">return </span><span class="s1">dataOutput</span>
<a name="l252"><span class="ln">252  </span></a>
<a name="l253"><span class="ln">253  </span></a>    <span class="s0">def </span><span class="s1">toXmlName(self</span><span class="s0">, </span><span class="s1">name):</span>
<a name="l254"><span class="ln">254  </span></a>        <span class="s1">nameFirst = name[</span><span class="s4">0</span><span class="s1">]</span>
<a name="l255"><span class="ln">255  </span></a>        <span class="s1">nameRest = name[</span><span class="s4">1</span><span class="s1">:]</span>
<a name="l256"><span class="ln">256  </span></a>        <span class="s1">m = nonXmlNameFirstBMPRegexp.match(nameFirst)</span>
<a name="l257"><span class="ln">257  </span></a>        <span class="s0">if </span><span class="s1">m:</span>
<a name="l258"><span class="ln">258  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Coercing non-XML name: %s&quot; </span><span class="s1">% name</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l259"><span class="ln">259  </span></a>            <span class="s1">nameFirstOutput = self.getReplacementCharacter(nameFirst)</span>
<a name="l260"><span class="ln">260  </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l261"><span class="ln">261  </span></a>            <span class="s1">nameFirstOutput = nameFirst</span>
<a name="l262"><span class="ln">262  </span></a>
<a name="l263"><span class="ln">263  </span></a>        <span class="s1">nameRestOutput = nameRest</span>
<a name="l264"><span class="ln">264  </span></a>        <span class="s1">replaceChars = set(nonXmlNameBMPRegexp.findall(nameRest))</span>
<a name="l265"><span class="ln">265  </span></a>        <span class="s0">for </span><span class="s1">char </span><span class="s0">in </span><span class="s1">replaceChars:</span>
<a name="l266"><span class="ln">266  </span></a>            <span class="s1">warnings.warn(</span><span class="s2">&quot;Coercing non-XML name: %s&quot; </span><span class="s1">% name</span><span class="s0">, </span><span class="s1">DataLossWarning)</span>
<a name="l267"><span class="ln">267  </span></a>            <span class="s1">replacement = self.getReplacementCharacter(char)</span>
<a name="l268"><span class="ln">268  </span></a>            <span class="s1">nameRestOutput = nameRestOutput.replace(char</span><span class="s0">, </span><span class="s1">replacement)</span>
<a name="l269"><span class="ln">269  </span></a>        <span class="s0">return </span><span class="s1">nameFirstOutput + nameRestOutput</span>
<a name="l270"><span class="ln">270  </span></a>
<a name="l271"><span class="ln">271  </span></a>    <span class="s0">def </span><span class="s1">getReplacementCharacter(self</span><span class="s0">, </span><span class="s1">char):</span>
<a name="l272"><span class="ln">272  </span></a>        <span class="s0">if </span><span class="s1">char </span><span class="s0">in </span><span class="s1">self.replaceCache:</span>
<a name="l273"><span class="ln">273  </span></a>            <span class="s1">replacement = self.replaceCache[char]</span>
<a name="l274"><span class="ln">274  </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l275"><span class="ln">275  </span></a>            <span class="s1">replacement = self.escapeChar(char)</span>
<a name="l276"><span class="ln">276  </span></a>        <span class="s0">return </span><span class="s1">replacement</span>
<a name="l277"><span class="ln">277  </span></a>
<a name="l278"><span class="ln">278  </span></a>    <span class="s0">def </span><span class="s1">fromXmlName(self</span><span class="s0">, </span><span class="s1">name):</span>
<a name="l279"><span class="ln">279  </span></a>        <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">set(self.replacementRegexp.findall(name)):</span>
<a name="l280"><span class="ln">280  </span></a>            <span class="s1">name = name.replace(item</span><span class="s0">, </span><span class="s1">self.unescapeChar(item))</span>
<a name="l281"><span class="ln">281  </span></a>        <span class="s0">return </span><span class="s1">name</span>
<a name="l282"><span class="ln">282  </span></a>
<a name="l283"><span class="ln">283  </span></a>    <span class="s0">def </span><span class="s1">escapeChar(self</span><span class="s0">, </span><span class="s1">char):</span>
<a name="l284"><span class="ln">284  </span></a>        <span class="s1">replacement = </span><span class="s2">&quot;U%05X&quot; </span><span class="s1">% ord(char)</span>
<a name="l285"><span class="ln">285  </span></a>        <span class="s1">self.replaceCache[char] = replacement</span>
<a name="l286"><span class="ln">286  </span></a>        <span class="s0">return </span><span class="s1">replacement</span>
<a name="l287"><span class="ln">287  </span></a>
<a name="l288"><span class="ln">288  </span></a>    <span class="s0">def </span><span class="s1">unescapeChar(self</span><span class="s0">, </span><span class="s1">charcode):</span>
<a name="l289"><span class="ln">289  </span></a>        <span class="s0">return </span><span class="s1">chr(int(charcode[</span><span class="s4">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s4">16</span><span class="s1">))</span>
<a name="l290"><span class="ln">290  </span></a></pre>
</body>
</html>